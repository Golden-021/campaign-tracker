
<!DOCTYPE html>
<html>
<head>
  <title>Campaign Data Entry</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f4f6f8;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 600px;
      margin: 40px auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.08);
      padding: 40px 30px 30px 30px;
    }
    h1 {
      text-align: center;
      color: #1a237e;
      margin-bottom: 30px;
      font-size: 2em;
      letter-spacing: 1px;
    }
    .option-buttons {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-bottom: 30px;
    }
    .option-btn {
      background: #3949ab;
      color: #fff;
      border: none;
      border-radius: 7px;
      padding: 14px 36px;
      font-size: 1.1em;
      cursor: pointer;
      transition: background 0.2s;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
    }
    .option-btn:hover {
      background: #283593;
    }
    .entry-form {
      display: none;
      margin-top: 20px;
    }
    label {
      font-weight: 500;
      color: #333;
      margin-bottom: 6px;
      display: block;
    }
    input, select, textarea, button {
      width: 100%;
      margin-top: 8px;
      margin-bottom: 18px;
      padding: 10px;
      font-size: 1em;
      border-radius: 5px;
      border: 1px solid #bdbdbd;
      background: #fafbfc;
      box-sizing: border-box;
    }
    textarea { resize: vertical; }
    button[type="button"], button[type="submit"] {
      background: #3949ab;
      color: #fff;
      border: none;
      border-radius: 5px;
      padding: 12px 0;
      font-size: 1.1em;
      cursor: pointer;
      transition: background 0.2s;
      margin-top: 10px;
    }
    button[type="button"]:hover, button[type="submit"]:hover {
      background: #283593;
    }
    #spinner {
      display: none;
      margin: 20px auto;
      border: 7px solid #f3f3f3;
      border-top: 7px solid #3949ab;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }
    #msg {
      text-align: center;
      font-size: 1.1em;
      margin-top: 10px;
      color: #388e3c;
      font-weight: 500;
    }
    @media (max-width: 700px) {
      .container { padding: 10px; }
      .option-buttons { flex-direction: column; gap: 16px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Campaign Data Entry</h1>
    <div class="option-buttons">
      <button class="option-btn" onclick="showForm('db')">Add Database</button>
      <button class="option-btn" onclick="showForm('campaign')">Add Campaign</button>
    </div>

    <!-- Database Entry Form -->
    <form id="dbForm" class="entry-form">
      <label>Database Name</label>
      <input type="text" name="name" required>
      <label>Source</label>
      <input type="text" name="source" required>
      <label>Industry</label>
      <input type="text" name="industry" required>
      <label>Total No. of Records</label>
      <input type="number" name="totalRecords" required>
      <label>No. of Emails</label>
      <input type="number" name="noOfEmails" required>
      <label>No. of Valid Emails</label>
      <input type="number" name="noOfValidEmails" required>
      <label>No. of Mobile No.</label>
      <input type="number" name="noOfMobile" required>
      <label>No. of WhatsApp Valid Mobile No.</label>
      <input type="number" name="noOfValidWhatsApp" required>
      <label>Description</label>
      <textarea name="description"></textarea>
      <button type="button" onclick="addDatabase()">Add Database</button>
    </form>

    <!-- Campaign Entry Form -->
    <form id="campaignForm" class="entry-form">
      <label>Select Database</label>
      <select name="databaseName" id="databaseDropdown" required>
        <option value="">-- Select Database --</option>
      </select>
      <label>Campaign Type</label>
      <select name="campaignType" required>
        <option value="">Select Campaign Type</option>
        <option value="whatsapp1">WhatsApp 1</option>
        <option value="whatsapp2">WhatsApp 2</option>
        <option value="email1">Email 1</option>
        <option value="email2">Email 2</option>
        <option value="telecalling">Telecalling</option>
      </select>
      <label>Date</label>
      <input type="date" name="date" required>
      <label>No. of Records</label>
      <input type="number" name="noOfRecords" required>
      <label>No. of Leads Came</label>
      <input type="number" name="noOfLeads" required>
      <button type="button" onclick="addCampaign()">Add Campaign</button>
    </form>
    <div id="spinner"></div>
    <div id="msg"></div>
  </div>
  <script>
    const scriptUrl = 'https://script.google.com/macros/s/AKfycbzHlUoTop8QFLSfEG6aNqdpFAYxTdYs56BHcxGylZRAaJRQFK9fEmH8Qxg8HiTpALh66g/exec'; 

    function showForm(type) {
      document.getElementById('msg').textContent = '';
      document.getElementById('dbForm').style.display = (type === 'db') ? 'block' : 'none';
      document.getElementById('campaignForm').style.display = (type === 'campaign') ? 'block' : 'none';
      if (type === 'campaign') populateDatabaseDropdown();
    }

    function showSpinner() {
      document.getElementById('spinner').style.display = 'block';
    }
    function hideSpinner() {
      document.getElementById('spinner').style.display = 'none';
    }

    function addDatabase() {
      const form = document.getElementById('dbForm');
      const data = Object.fromEntries(new FormData(form).entries());
      showSpinner();
      fetch(scriptUrl + '?action=addDatabase', {
        method: 'POST',
        body: JSON.stringify(data),
        headers: { 'Content-Type': 'application/json' }
      })
      .then(res => res.json())
      .then(res => {
        document.getElementById('msg').style.color = res.success ? "#388e3c" : "#b71c1c";
        document.getElementById('msg').textContent = res.success ? "Database added successfully!" : "Error adding database.";
        if (res.success) form.reset();
        hideSpinner();
      })
      .catch(() => { hideSpinner(); });
    }

    function addCampaign() {
      const form = document.getElementById('campaignForm');
      const data = Object.fromEntries(new FormData(form).entries());
      showSpinner();
      fetch(scriptUrl + '?action=addCampaign', {
        method: 'POST',
        body: JSON.stringify(data),
        headers: { 'Content-Type': 'application/json' }
      })
      .then(res => res.json())
      .then(res => {
        document.getElementById('msg').style.color = res.success ? "#388e3c" : "#b71c1c";
        document.getElementById('msg').textContent = res.success ? "Campaign added successfully!" : "Error adding campaign.";
        if (res.success) form.reset();
        hideSpinner();
      })
      .catch(() => { hideSpinner(); });
    }

    function populateDatabaseDropdown() {
      showSpinner();
      fetch(scriptUrl + '?action=getDatabaseNames')
        .then(res => res.json())
        .then(names => {
          const select = document.getElementById('databaseDropdown');
          while (select.options.length > 1) select.remove(1);
          if (Array.isArray(names) && Array.isArray(names[0])) {
            names = names.map(row => row[0]);
          }
          names.forEach(name => {
            if (name && name.toString().trim()) {
              const opt = document.createElement('option');
              opt.value = name;
              opt.textContent = name;
              select.appendChild(opt);
            }
          });
          hideSpinner();
        })
        .catch(() => hideSpinner());
    }
  </script>
</body>
</html>
